

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CNS Installation &mdash; haddock3 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=34bb78ad" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=acc74ff5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            haddock3
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">A brief introduction to HADDOCK3</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="USAGE.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Workflow Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Advanced features</a></li>
<li class="toctree-l1"><a class="reference internal" href="clients/haddock.clis.html">Command-line interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/index.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to HADDOCK3</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Library Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">haddock3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CNS Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/CNS.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cns-installation">
<h1>CNS Installation<a class="headerlink" href="#cns-installation" title="Link to this heading"></a></h1>
<p>The computational engine for most of HADDOCK3’s modules is the <a class="reference external" href="http://cns-online.org/v1.3/">Crystallography and NMR System (CNS)</a>.
Once you have <a class="reference internal" href="INSTALL.html"><span class="std std-doc">cloned the HADDOCK3 repository</span></a>, please follow these instructions to compile a CNS executable that can be used to run HADDOCK.</p>
<p>Before starting, make sure you download the system requirements, they are <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> and <code class="docutils literal notranslate"><span class="pre">csh</span></code>. Luckily they are easily available from the package manager, so if you are using Ubuntu (for example):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>gcc<span class="w"> </span>gfortran<span class="w"> </span>csh
</pre></div>
</div>
<blockquote>
<div><p>Make sure <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> is in your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>, check it with <code class="docutils literal notranslate"><span class="pre">which</span> <span class="pre">gfortran</span></code>.</p>
</div></blockquote>
<section id="downloading-cns">
<h2>1. Downloading CNS<a class="headerlink" href="#downloading-cns" title="Link to this heading"></a></h2>
<p>Downloading CNS requires a license, which academic users can <a class="reference external" href="http://cns-online.org">request for free</a>.</p>
<p>To Download CNS, go to their <a class="reference external" href="http://cns-online.org">website</a> and  click on the <code class="docutils literal notranslate"><span class="pre">Download</span></code> menu and fill the form. You will be sent a password for the download via e-mail - keep in mind only education e-mails are allowed for this.</p>
<p>You will receive a login/password in the e-mail, once you have those go to the <a class="reference external" href="http://cns-online.org/download/v1.3/cns_solve_1.3_all.tar.gz">download page</a> and use the provided login/password to download the CNS package - the archive you need is: <code class="docutils literal notranslate"><span class="pre">cns_solve_1.3_all.tar.gz</span></code>.</p>
<blockquote>
<div><p>The CNS website is not currently using SSL certificates, this mean your download might be blocked or it might give you a warning, double check in your browser.</p>
</div></blockquote>
<p>Once the archive <code class="docutils literal notranslate"><span class="pre">cns_solve_1.3_all.tar.gz</span></code> has been downloaded, move it to a <code class="docutils literal notranslate"><span class="pre">$HOME/software</span></code> directory (or any other directory of your choice) and decompress it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>~/software
mv<span class="w"> </span>~/Downloads/cns_solve_1.3_all.tar.gz<span class="w"> </span>~/software/
tar<span class="w"> </span>-zxvf<span class="w"> </span>cns_solve_1.3_all.tar.gz
</pre></div>
</div>
<p>The command above will have create a <code class="docutils literal notranslate"><span class="pre">cns_solve_1.3</span></code> directory in the <code class="docutils literal notranslate"><span class="pre">~/software</span></code> directory, containing the CNS source code.</p>
</section>
<section id="configuring-cns">
<h2>2. Configuring CNS<a class="headerlink" href="#configuring-cns" title="Link to this heading"></a></h2>
<p>Go to the CNS directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>cns_solve_1.3
</pre></div>
</div>
<p>Inside this directory there will be a <code class="docutils literal notranslate"><span class="pre">cns_solve_env</span></code> file.</p>
<p>You need to edit this file to point to the current directory.</p>
<p>You will need to change line 18 of this file to point to the current directory.</p>
<p>You can do that either by opening this file in a code editor such as VScode or vim, or by running the command below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s@_CNSsolve_location_@&#39;</span><span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">&quot;</span><span class="s1">&#39;@&#39;</span><span class="w"> </span>cns_solve_env
</pre></div>
</div>
<blockquote>
<div><p><strong>Note:</strong> On a Mac, the default sed version will give an error with the above command. Install instead <code class="docutils literal notranslate"><span class="pre">gnu-sed</span></code> using <code class="docutils literal notranslate"><span class="pre">brew</span></code>, and then replace <code class="docutils literal notranslate"><span class="pre">sed</span></code> by <code class="docutils literal notranslate"><span class="pre">gsed</span></code> in the above command.</p>
</div></blockquote>
<p>Check if the substitution worked:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span>-n<span class="w"> </span>18p<span class="w"> </span>cns_solve_env
</pre></div>
</div>
<p>The expected output will be (with the path to your CNS installation directory):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">        </span>setenv<span class="w"> </span>CNS_SOLVE<span class="w"> </span><span class="s1">&#39;/Absolute/path/where/cns_solve/is/cns_solve_1.3&#39;</span>
</pre></div>
</div>
</section>
<section id="patch-cns-with-haddock-custom-files">
<h2>3. Patch CNS with HADDOCK custom files<a class="headerlink" href="#patch-cns-with-haddock-custom-files" title="Link to this heading"></a></h2>
<p>For HADDOCK to use CNS, some modifications were made to the CNS source code. We provide those modifications together with the haddock3 source files.</p>
<blockquote>
<div><p>❗ You cannot use CNS in HADDOCK without these patched files❗</p>
</div></blockquote>
<p>Copy the CNS files distributed with HADDOCK3 to the CNS directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="se">\c</span>p<span class="w"> </span>-r<span class="w"> </span>~/software/haddock3/varia/cns1.3/<span class="o">[</span>bis<span class="o">]</span>*<span class="w">  </span>~/software/cns_solve_1.3/
</pre></div>
</div>
<blockquote>
<div><p><strong>Note:</strong> Make sure to use the correct path to your haddock3 location in the above command.</p>
</div></blockquote>
</section>
<section id="compiling-cns">
<h2>4. Compiling CNS<a class="headerlink" href="#compiling-cns" title="Link to this heading"></a></h2>
<p>Before installing CNS, you need to check wether your operating system is supported by CNS.</p>
<p>The list of supported architectures can be seen with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>~/software/cns_solve_1.3/instlib/machine/supported
arm-aarch64-linux<span class="w">  </span>intel-x86_64bit-linux<span class="w">  </span>linux<span class="w">  </span>mac-arm-darwin<span class="w">  </span>mac-intel-darwin
</pre></div>
</div>
<p>To check what is <em>your</em> architecture, type the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/software/cns_solve_1.3/bin/getarch
</pre></div>
</div>
<blockquote>
<div><p>You might get something like <code class="docutils literal notranslate"><span class="pre">unknown-...</span></code>, in that case installation is still possible, however it means the compiler options might not be properly defined - check the Troubleshooting section</p>
</div></blockquote>
<p>Several <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> headers are already provided - here we will use on the one that uses <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> as the compiler.</p>
<p>Now it is time to compile CNS, you can do that with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>install<span class="w"> </span><span class="nv">compiler</span><span class="o">=</span>gfortran
</pre></div>
</div>
<p>You should see the progress of the compilation, followed by a confirmation that an executable has been created.</p>
<p>The executable will be located in a new architecture-specific directory.</p>
<p>For example under Linux (Intel or AMD processors) it will be under <code class="docutils literal notranslate"><span class="pre">~software/cns_solve_1.3/intel-x86_64bit-linux/source/cns_solve-XXXXXXX.exe</span></code>
And on a Mac with arm processors (M1/2/3) is will be under <code class="docutils literal notranslate"><span class="pre">~software/cns_solve_1.3/mac-arm64-darwin/source/cns_solve-XXXXXXX.exe</span></code></p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">XXXXXXX</span></code> will be a number specific to your compilation.</p>
</div></blockquote>
<p>Check if it is working by executing it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/software/cns_solve_1.3/intel-x86_64bit-linux/source/cns_solve-2405221906.exe
</pre></div>
</div>
<p>If you see the CNS prompt, the compilation was successful! 🎉</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>============================================================
|                                                          |
|            Crystallography &amp; NMR System (CNS)            |
|                         CNSsolve                         |
|                                                          |
============================================================
 Version: 1.3 at patch level U
 Status: Special UU release with Rg, paramagnetic
         and Z-restraints (A. Bonvin, UU 2013)
============================================================
</pre></div>
</div>
<p>The command to exit CNS is <code class="docutils literal notranslate"><span class="pre">stop</span></code>!</p>
<p>If this does not work, check the <a class="reference internal" href="#troubleshooting">troubleshooting section</a> below.</p>
<blockquote>
<div><p><strong>Note:</strong> If you want to use CNS as standalone application, you should first source the <code class="docutils literal notranslate"><span class="pre">cns_solve_env</span></code> file (csh) or <code class="docutils literal notranslate"><span class="pre">.cns_solve_env_sh</span></code> file (bash). CNS will then be defined in you path and can be simply started using <code class="docutils literal notranslate"><span class="pre">cns</span></code> as command. If using bash, make sure to first edit the <code class="docutils literal notranslate"><span class="pre">cns_solve_env</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">.cns_solve_env_sh</span></code> file to define the installation directory as described above.</p>
</div></blockquote>
</section>
<section id="installing-the-created-cns-executable-into-haddock3">
<h2>5. Installing the created CNS executable into haddock3<a class="headerlink" href="#installing-the-created-cns-executable-into-haddock3" title="Link to this heading"></a></h2>
<p>You can find the freshly compiled CNS executable a newly created directory in the CNS installation directory named after the architecture of your system. E.g. for a M1/2/3/ Mac Arm processor it will be <code class="docutils literal notranslate"><span class="pre">mac-arm64-darwin</span></code>. In the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory in that directory you can find the compiled CNS executable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>mac-arm64-darwin/source/*exe
&gt;<span class="w"> </span>mac-arm64-darwin/source/cns_solve-2405221019.exe
</pre></div>
</div>
<p>You can then copy this executable into the <code class="docutils literal notranslate"><span class="pre">haddock3/bin</span></code> directory, renaming it simply to <code class="docutils literal notranslate"><span class="pre">cns</span></code>.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="system-not-recognized">
<h3>1. System not recognized<a class="headerlink" href="#system-not-recognized" title="Link to this heading"></a></h3>
<p>If the installation fails because your OS/hardware are not recognized, most likely the <code class="docutils literal notranslate"><span class="pre">bin/getarch</span></code> script needs to be updated.</p>
<p>From within your CNS installation directory type the following command to check if your system is recognized:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./bin/getarch
</pre></div>
</div>
<p>For an unknown system you might see as output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>~/software/cns_solve_1.31-UU&gt; ./bin/getarch
unknown-...
</pre></div>
</div>
<p>If your OS/hardware is unknown, this is not per se a problem, but it means the compiler options might not be properly defined.
For example, the default CNS package will not recognize the Mac M1/2/3/ processors (but after copying the CNS files distributed with haddock3 it should!).
To solve that edit the <code class="docutils literal notranslate"><span class="pre">./bin/get_arch</span></code> script and add lines such as your system be recognized (e.g. after line 179 - this should be added after a line containing <code class="docutils literal notranslate"><span class="pre">exit</span> <span class="pre">0</span></code>). Here is an example to add support for the Mac M1/2/3 processors:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>arm64:Darwin:*:*<span class="o">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>mac-arm64-darwin
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">;;</span>
</pre></div>
</div>
<p>You should then create a directory under <code class="docutils literal notranslate"><span class="pre">instlib/machine/supported</span></code> with the same name as the one you defined in <code class="docutils literal notranslate"><span class="pre">getarch</span></code>. Copy then and edit if needed the files from another supported system into the directory you created.</p>
</section>
<section id="compiler">
<h3>2. Compiler<a class="headerlink" href="#compiler" title="Link to this heading"></a></h3>
<p>If no suitable compiler is found, you will get an error message:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Error: no suitable compiler (ifort, pgf95, ifort_i4, ifort_mp or pgf95_mp) found
</pre></div>
</div>
<p>In this case, you will have to install a compiler. For more information, check the <a class="reference external" href="http://cns-online.org/v1.3/installation/frame.html">CNS Installation page</a>.
One Fortran compiler that is easy (and free) to install is <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>. It is part of the GNU Compiler Collection (GCC), which can be installed with one command if you have homebrew:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>gcc
</pre></div>
</div>
<p>Alternatively, gfortran can be downloaded as a <a class="reference external" href="https://gcc.gnu.org/wiki/GFortranBinaries">separate binary</a>.</p>
</section>
<section id="makefile">
<h3>3. Makefile<a class="headerlink" href="#makefile" title="Link to this heading"></a></h3>
<p>If a suitable compiler is installed but no corresponding <code class="docutils literal notranslate"><span class="pre">Makefile.header</span></code> is found, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> will give an error as well. For example (with gfortran):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Error: Makefile template for compiler gfortran is not available
</pre></div>
</div>
<p>Makefile headers for each supported system-compiler combination are provided in <code class="docutils literal notranslate"><span class="pre">instlib/machine/supported/</span></code> (for unsupported systems, see <code class="docutils literal notranslate"><span class="pre">instlib/machine/unsupported/</span></code>). If you already tried <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code>, the appropriate directory for your system (eg. <code class="docutils literal notranslate"><span class="pre">mac-intel-darwin</span></code>) will have been copied to the main <code class="docutils literal notranslate"><span class="pre">cns_solve_1.3</span></code> directory.
If this directory does not contain the desired file (eg. <code class="docutils literal notranslate"><span class="pre">Makefile.header.2.gfortran</span></code>), you can create one manually.</p>
<p>For example, for <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>, create a new file named <code class="docutils literal notranslate"><span class="pre">Makefile.header.6.gfortran</span></code> inside the directory containing Makefile headers for your system. Save the following lines in this file:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># fortran options</span>
<span class="nv">F77</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>gfortran
<span class="nv">F77STD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-fdefault-integer-8<span class="w"> </span>-w<span class="w"> </span>-fallow-argument-mismatch
<span class="nv">F77OPT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-O3<span class="w"> </span><span class="k">$(</span>CNS_MALIGN_I86<span class="k">)</span><span class="w"> </span>-funroll-loops<span class="w"> </span>-ffast-math<span class="w"> </span>-march<span class="o">=</span>native<span class="w"> </span>-mtune<span class="o">=</span>native
<span class="nv">F77FLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>F77STD<span class="k">)</span><span class="w"> </span><span class="k">$(</span>F77OPT<span class="k">)</span><span class="w"> </span><span class="k">$(</span>EXT_F77FLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>F77BUG<span class="k">)</span>

<span class="c"># C options</span>
<span class="nv">CC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>gcc
<span class="nv">CPP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g++
<span class="nv">CCFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-O<span class="w"> </span>-DINTEGER<span class="o">=</span><span class="s1">&#39;long int&#39;</span><span class="w"> </span>-DCNS_ARCH_TYPE_<span class="k">$(</span>CNS_ARCH_TYPE<span class="k">)</span><span class="w"> </span><span class="k">$(</span>EXT_CCFLAGS<span class="k">)</span>

<span class="c"># link options</span>
<span class="nv">LD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>gfortran
<span class="nv">LDFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-w<span class="w"> </span><span class="k">$(</span>EXT_LDFLAGS<span class="k">)</span><span class="w"> </span>-static-libgfortran
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">-fallow-argument-mismatch</span></code> flag. From gfortran version 10 onward, type mismatches by default give an error rather than a warning. This flag returns warnings instead, so that CNS compilation can successfully complete. If a <code class="docutils literal notranslate"><span class="pre">Makefile.header.x.gfortran</span></code> is provided for your system but compilation fails with (many) <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">Type</span> <span class="pre">mismatch</span></code>, you may need to add this flag to the provided file.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, BonvinLab.
      <span class="lastupdated">Last updated on Oct 01, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>