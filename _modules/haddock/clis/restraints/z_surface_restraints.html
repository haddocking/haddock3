

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>haddock.clis.restraints.z_surface_restraints &mdash; haddock3 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=34bb78ad" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=acc74ff5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            haddock3
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro.html">A brief introduction to HADDOCK3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../USAGE.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Workflow Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Advanced features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../clients/haddock.clis.html">Command-line interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/index.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contributing to HADDOCK3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">Library Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">haddock3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../haddock.html">haddock</a></li>
      <li class="breadcrumb-item active">haddock.clis.restraints.z_surface_restraints</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for haddock.clis.restraints.z_surface_restraints</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;haddock3-restraints z-surface-restraints subcommand.</span>

<span class="sd">Generate both z-restraints and corresponding z-surfaces based on</span>
<span class="sd">input pdb structure and residue selection.</span>

<span class="sd">Usage:</span>
<span class="sd">    haddock3-restraints z-surface-restraints</span>
<span class="sd">        --pdb       &lt;path/to/the/structure.pdb&gt;</span>
<span class="sd">        --residues  &lt;list of coma separated residue index&gt;</span>
<span class="sd">        --output    &lt;base/path/where/to/output/data&gt;</span>
<span class="sd">        --spacing   &lt;spacing_between_two_beads&gt;</span>
<span class="sd">        --x-size    &lt;size_in_x_dim&gt;</span>
<span class="sd">        --y-size    &lt;size_in_y_dim&gt;</span>
<span class="sd">        --z-padding &lt;additional_z_padding_between_two_extrema_plans&gt;</span>

<span class="sd">e.g:</span>
<span class="sd">haddock3-restraints z-surface-restraints</span>
<span class="sd">  --pdb mystructure.pdb</span>
<span class="sd">  --residues 1,2,3 7,8,9</span>
<span class="sd">  --spacing 20</span>
<span class="sd">  --x-size 200</span>
<span class="sd">  --y-size 200</span>
<span class="sd">  --z-padding 5</span>
<span class="sd">  --output myZrestaints</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">haddock.core.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">haddock.libs.librestraints</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_structure</span><span class="p">,</span> <span class="n">calc_euclidean</span>


<span class="c1"># As this script is a subcommand of the `haddock3-restraints` cli,</span>
<span class="c1"># it requires its own options and arguments that are managed here.</span>
<div class="viewcode-block" id="add_z_surf_restraints_arguments">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.add_z_surf_restraints_arguments">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_z_surf_restraints_arguments</span><span class="p">(</span><span class="n">z_surf_restraints_subcommand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add arguments to the z_plan subcommand.&quot;&quot;&quot;</span>
    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to a pdb file.&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--residues&quot;</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;List of comma separated residues (can be multiple selections). &quot;</span>
            <span class="s2">&quot;Example 1,2,3 7,8,9 for two selections.&quot;</span>
            <span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Base output path. This script will generate two files, &quot;</span>
            <span class="s2">&quot;therefore no extention needed here&quot;</span>
            <span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--spacing&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Spacing between two beads (A)&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--x-size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-x&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Size of the plan in X dimension (A)&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--y-size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-y&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Size of the plan in Y dimension&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--z-padding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-z&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Additional padding between two external plans.&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="n">z_surf_restraints_subcommand</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--log_level&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logging level&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">z_surf_restraints_subcommand</span></div>



<div class="viewcode-block" id="setup_logging">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.setup_logging">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set log level and format.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> L</span><span class="si">%(lineno)d</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y %H:%M:%S&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>



<span class="c1">############################</span>
<span class="c1"># SET OF USEFULL FUNCTIONS #</span>
<span class="c1">############################</span>
<div class="viewcode-block" id="load_selected_resiudes_coords">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.load_selected_resiudes_coords">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_selected_resiudes_coords</span><span class="p">(</span>
        <span class="n">pdb_fpath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">selections</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load coordinates of selected residues.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pdb_fpath : Union[str, Path]</span>
<span class="sd">        Path to the PDB file to be parsed.</span>
<span class="sd">    selections : dict[str, list[int]]</span>
<span class="sd">        Dictionary holding the various residues indices for each selection.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    selection_coords: dict[str, list[tuple[float, float, float]]]</span>
<span class="sd">        Dictionary holding the various Calpha coordinates for each selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load structures atom coordinates</span>
    <span class="n">pdb_atoms</span> <span class="o">=</span> <span class="n">read_structure</span><span class="p">(</span><span class="n">pdb_fpath</span><span class="p">)</span>
    <span class="c1"># Set paring variables</span>
    <span class="n">selection_coords</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">selected_chains</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">selected_atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Loop over atoms</span>
    <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">resi</span><span class="p">,</span> <span class="n">atname</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">pdb_atoms</span><span class="p">:</span>
        <span class="c1"># Simplify the probleme to Calpha/Phosphates/BackBone atoms only</span>
        <span class="c1"># FIXME: maybe change P to C1 or C9 ?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">atname</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;BB&quot;</span><span class="p">,</span> <span class="p">):</span>
            <span class="k">continue</span>
        <span class="c1"># Loop over selections</span>
        <span class="k">for</span> <span class="n">selection</span><span class="p">,</span> <span class="n">sele_resis</span> <span class="ow">in</span> <span class="n">selections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check if residue of interest</span>
            <span class="k">if</span> <span class="n">resi</span> <span class="ow">in</span> <span class="n">sele_resis</span><span class="p">:</span>
                <span class="c1"># Make sure the key is created</span>
                <span class="n">selection_coords</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="p">[])</span>
                <span class="c1"># Hold this coordinates</span>
                <span class="n">selection_coords</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
                <span class="c1"># Also add chain and atom type</span>
                <span class="n">selected_chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="n">selected_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atname</span><span class="p">)</span>
    <span class="n">set_selected_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">selected_chains</span><span class="p">))</span>
    <span class="n">set_selected_atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">selected_atoms</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">selection_coords</span><span class="p">,</span> <span class="n">set_selected_chains</span><span class="p">,</span> <span class="n">set_selected_atoms</span></div>



<div class="viewcode-block" id="compute_barycenter">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.compute_barycenter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_barycenter</span><span class="p">(</span>
        <span class="n">resi_coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute center of mass of multiple resiudes coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resi_coords : list[tuple[float, float, float]]</span>
<span class="sd">        List of Calpha coordinates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    barycenter : tuple[float, float, float]</span>
<span class="sd">        Corrdinates of the center of mass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Combine coordinates</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">resi_coords</span><span class="p">:</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># Compute average</span>
    <span class="n">x_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">y_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="n">z_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
    <span class="c1"># Return barycenter</span>
    <span class="n">barycenter</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_avg</span><span class="p">,</span> <span class="n">y_avg</span><span class="p">,</span> <span class="n">z_avg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">barycenter</span></div>



<div class="viewcode-block" id="load_selections">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.load_selections">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_selections</span><span class="p">(</span><span class="n">residues_lists</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split and cast residues from an initial string to list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    residues_lists : list[str]</span>
<span class="sd">        List of strings containing coma separated resiudes indices.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    selections: dict[str, list[int]]</span>
<span class="sd">        Dictionary of resiudes indices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selections</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">listid</span><span class="p">,</span> <span class="n">str_resiudes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">residues_lists</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">resid_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">selection_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;selection_</span><span class="si">{</span><span class="n">listid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">strresid</span> <span class="ow">in</span> <span class="n">str_resiudes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">strresid</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Could not cast residue </span><span class="si">{</span><span class="n">strresid</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">selection_key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resid_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resid_indices</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Not considering </span><span class="si">{</span><span class="n">selection_key</span><span class="si">}</span><span class="s2"> as it is empty !&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selections</span><span class="p">[</span><span class="n">selection_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resid_indices</span>
    <span class="k">return</span> <span class="n">selections</span></div>



<div class="viewcode-block" id="get_z_coords">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.get_z_coords">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_z_coords</span><span class="p">(</span>
        <span class="n">select_coords</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">padding</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate z-coordinates from selection of residues.</span>

<span class="sd">    Here the idea is to find the most distant points between selections,</span>
<span class="sd">    and project it on a Z axis to be able to later orient the protein.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    selection_coords: dict[str, list[tuple[float, float, float]]]</span>
<span class="sd">        Dictionary holding the various Calpha coordinates for each selection.</span>
<span class="sd">    padding : float, optional</span>
<span class="sd">        Extra padding (in Angstrom) of z-coordinate, by default 10</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    selection_z : dict[str, float]</span>
<span class="sd">        Z coodrinate for each selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Default when less than 1 selection was made</span>
    <span class="k">if</span> <span class="n">select_coords</span> <span class="o">==</span> <span class="p">{}:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;z_1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_coords</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">select_coords</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="c1"># Compute geometrical center</span>
    <span class="n">select_centers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">select</span><span class="p">:</span> <span class="n">compute_barycenter</span><span class="p">(</span><span class="n">select_resids_coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">select</span><span class="p">,</span> <span class="n">select_resids_coords</span> <span class="ow">in</span> <span class="n">select_coords</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="c1"># Compute distances</span>
    <span class="n">dists</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">select_centers</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="n">max_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">max_dist_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">select</span><span class="p">,</span> <span class="n">center</span> <span class="ow">in</span> <span class="n">select_centers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">select2</span><span class="p">,</span> <span class="n">center2</span> <span class="ow">in</span> <span class="n">select_centers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">select</span> <span class="o">==</span> <span class="n">select2</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Compute dist</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">calc_euclidean</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">center2</span><span class="p">)</span>
            <span class="c1"># Hold data</span>
            <span class="n">dists</span><span class="p">[</span><span class="n">select</span><span class="p">][</span><span class="n">select2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="n">dists</span><span class="p">[</span><span class="n">select2</span><span class="p">][</span><span class="n">select</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="c1"># Define max</span>
            <span class="k">if</span> <span class="n">max_dist</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">:</span>
                <span class="n">max_dist</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">max_dist_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">select</span><span class="p">,</span> <span class="n">select2</span><span class="p">]</span>
    <span class="c1"># Initiate z-coords boundaries</span>
    <span class="n">max_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">padding</span> <span class="o">+</span> <span class="n">max_dist</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># Compute Z coords for external surfaces</span>
    <span class="n">selection_z</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">max_dist_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">max_z</span><span class="p">,</span>
        <span class="n">max_dist_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="o">-</span><span class="n">max_z</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="c1"># Compute Z coords for internal surfaces (when nb. selections &gt;= 3)</span>
    <span class="k">for</span> <span class="n">select</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">dists</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># If the selection is part of the external surfaces</span>
        <span class="k">if</span> <span class="n">select</span> <span class="ow">in</span> <span class="n">max_dist_keys</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Compute location of z coordinate</span>
        <span class="n">dist_to_upper</span> <span class="o">=</span> <span class="n">max_z</span> <span class="o">-</span> <span class="n">dist</span><span class="p">[</span><span class="n">max_dist_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">dist_to_lower</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">max_dist_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">max_z</span>
        <span class="n">select_z_coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist_to_upper</span> <span class="o">+</span> <span class="n">dist_to_lower</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># Hold data</span>
        <span class="n">selection_z</span><span class="p">[</span><span class="n">select</span><span class="p">]</span> <span class="o">=</span> <span class="n">select_z_coord</span>
    
    <span class="k">return</span> <span class="n">selection_z</span></div>



<div class="viewcode-block" id="gen_z_restraints">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.gen_z_restraints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gen_z_restraints</span><span class="p">(</span>
        <span class="n">res_select</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="n">selection_z</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">rest_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">7.5</span><span class="p">,</span>
        <span class="n">segids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">],</span>
        <span class="n">atome_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate set of z ambiguous restraints according to residue selections.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    res_select : dict[str, list[int]]</span>
<span class="sd">        Dictionary holding the various residues indices for each selection.</span>
<span class="sd">    selection_z : dict[str, float]</span>
<span class="sd">        Z coodrinate for each selection.</span>
<span class="sd">    rest_dist : float, optional</span>
<span class="sd">        Upper boundary (in Angstrom) of satisfied restraints, by default 7.5</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    all_restraints : str</span>
<span class="sd">        A string containing the AIR restraints.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Gather all coordinates</span>
    <span class="n">all_z_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">zcoord</span> <span class="k">for</span> <span class="n">zcoord</span> <span class="ow">in</span> <span class="n">selection_z</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="c1"># Point min and max values</span>
    <span class="n">minz</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_z_coords</span><span class="p">)</span>
    <span class="n">maxz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_z_coords</span><span class="p">)</span>
    <span class="c1"># Initiate restraints holder</span>
    <span class="n">restraints</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># z_padding variable is used as a padding for the Z beads selection.</span>
    <span class="c1"># This is meant for the CNS selection method using lt(lower than)</span>
    <span class="c1"># and gt (geater than) rather than equal to.</span>
    <span class="n">z_padding</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="c1"># Compile chain selection</span>
    <span class="n">chain_selection_string</span> <span class="o">=</span> <span class="n">_compile_multiple_cns_selections</span><span class="p">(</span>
        <span class="s2">&quot;segid&quot;</span><span class="p">,</span> <span class="n">segids</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Compile atome selection</span>
    <span class="n">atom_selection_string</span> <span class="o">=</span> <span class="n">_compile_multiple_cns_selections</span><span class="p">(</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">atome_types</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Loop over selections</span>
    <span class="k">for</span> <span class="n">select</span> <span class="ow">in</span> <span class="n">res_select</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># Point data</span>
        <span class="n">residues</span> <span class="o">=</span> <span class="n">res_select</span><span class="p">[</span><span class="n">select</span><span class="p">]</span>
        <span class="n">z_coord</span> <span class="o">=</span> <span class="n">selection_z</span><span class="p">[</span><span class="n">select</span><span class="p">]</span>
        <span class="c1"># Add comment</span>
        <span class="n">list_residues</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">])</span>
        <span class="n">restraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;! z restraints for </span><span class="si">{</span><span class="n">select</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">list_residues</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Loop over residues selection</span>
        <span class="k">for</span> <span class="n">resid</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
            <span class="c1"># Compute lower/greater than z-coord</span>
            <span class="n">lt_coord</span> <span class="o">=</span> <span class="n">z_coord</span> <span class="o">+</span> <span class="n">z_padding</span>
            <span class="n">gt_coord</span> <span class="o">=</span> <span class="n">z_coord</span> <span class="o">-</span> <span class="n">z_padding</span>
            <span class="c1"># If the lower Z coordinate plan</span>
            <span class="k">if</span> <span class="n">z_coord</span> <span class="o">==</span> <span class="n">minz</span><span class="p">:</span>
                <span class="n">rest</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;assign (resid </span><span class="si">{</span><span class="n">resid</span><span class="si">:</span><span class="s2">&gt;7d</span><span class="si">}</span><span class="s2"> and &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom_selection_string</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">chain_selection_string</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(name SHA and attr z lt </span><span class="si">{</span><span class="n">lt_coord</span><span class="si">:</span><span class="s2">&gt;-8.2f</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rest_dist</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rest_dist</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 0.0&quot;</span>
                    <span class="p">)</span>
            <span class="c1"># If the upper Z coordinate plan</span>
            <span class="k">elif</span> <span class="n">z_coord</span> <span class="o">==</span> <span class="n">maxz</span><span class="p">:</span>
                <span class="n">rest</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;assign (resid </span><span class="si">{</span><span class="n">resid</span><span class="si">:</span><span class="s2">&gt;7d</span><span class="si">}</span><span class="s2"> and &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom_selection_string</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">chain_selection_string</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(name SHA and attr z gt </span><span class="si">{</span><span class="n">gt_coord</span><span class="si">:</span><span class="s2">&gt;-8.2f</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rest_dist</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rest_dist</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 0.0&quot;</span>
                    <span class="p">)</span>
            <span class="c1"># If in between lower and upper plans (when nb. plans &gt;= 3)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rest</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;assign (resid </span><span class="si">{</span><span class="n">resid</span><span class="si">:</span><span class="s2">&gt;7d</span><span class="si">}</span><span class="s2"> and &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom_selection_string</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">chain_selection_string</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(name SHA and attr z lt </span><span class="si">{</span><span class="n">lt_coord</span><span class="si">:</span><span class="s2">&gt;-8.2f</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and attr z gt </span><span class="si">{</span><span class="n">gt_coord</span><span class="si">:</span><span class="s2">&gt;-8.2f</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rest_dist</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rest_dist</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 0.0&quot;</span>
                    <span class="p">)</span>
            <span class="n">restraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
    <span class="n">all_restraints</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restraints</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_restraints</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_compile_multiple_cns_selections</span><span class="p">(</span>
        <span class="n">selection_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">selections</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">logical_operator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a selection from multiple ones using logical operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    selection_key : str</span>
<span class="sd">        Name of the selection key. (e.g.: segid, name, resid, ...)</span>
<span class="sd">    selections : list[str]</span>
<span class="sd">        List of selections.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    combined_selection : str</span>
<span class="sd">        The combined selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selection_key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">selections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">compiled_selections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selection_key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">select</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">select</span> <span class="ow">in</span> <span class="n">selections</span>
        <span class="p">]</span>
    <span class="n">joined_selections</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">logical_operator</span><span class="si">}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">compiled_selections</span><span class="p">)</span>
    <span class="n">combined_selection</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">joined_selections</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="n">combined_selection</span>


<div class="viewcode-block" id="output_data">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.output_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">output_data</span><span class="p">(</span>
        <span class="n">restraints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">plans</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write output files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    restraints : str</span>
<span class="sd">        String containing the ambiguous restraints.</span>
<span class="sd">    plans : str</span>
<span class="sd">        String containing shape beads coordinates as PDB file.</span>
<span class="sd">    output : Optional[Union[str, Path]], optional</span>
<span class="sd">        Base output path, by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    restraints_fpath: str</span>
<span class="sd">        Path to the generated AIRs.</span>
<span class="sd">    beadplans_fpath : str</span>
<span class="sd">        Path to the generated PDB file containing beads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define base output path if not given</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;Zrestraints&#39;</span>
    <span class="c1"># Write restraints</span>
    <span class="n">restraints_fpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">.tbl&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">restraints_fpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filout</span><span class="p">:</span>
        <span class="n">filout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">restraints</span><span class="p">)</span>
    <span class="c1"># Write restraints</span>
    <span class="n">beadplans_fpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">_beads.pdb&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">beadplans_fpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filout</span><span class="p">:</span>
        <span class="n">filout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">plans</span><span class="p">)</span>
    <span class="c1"># Return filepaths</span>
    <span class="k">return</span> <span class="n">restraints_fpath</span><span class="p">,</span> <span class="n">beadplans_fpath</span></div>



<div class="viewcode-block" id="gen_bead_plans">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.gen_bead_plans">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gen_bead_plans</span><span class="p">(</span>
        <span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">x_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">y_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">z_coords</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate multiple bead plans.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spacing : float, optional</span>
<span class="sd">        Spacing (in Angstrom) between beads in same dimension, by default 40</span>
<span class="sd">    x_size : float, optional</span>
<span class="sd">        Width (in Angstrom) of the plan, by default 200</span>
<span class="sd">    y_size : float, optional</span>
<span class="sd">        Height (in Angstrom) of the plan, by default 200</span>
<span class="sd">    z_coords : Optional[list[float]], optional</span>
<span class="sd">        List of z-coordinates where to generate plans, by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bead_plans : str</span>
<span class="sd">        A PDB file containing multiple plans.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Presets</span>
    <span class="n">bead_plans</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">resindex</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">z_coords</span><span class="p">:</span>
        <span class="n">z_coords</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Loop over z-coords</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">z_coords</span><span class="p">:</span>
        <span class="n">plan</span><span class="p">,</span> <span class="n">resindex</span> <span class="o">=</span> <span class="n">bead_plan</span><span class="p">(</span>
            <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
            <span class="n">x_size</span><span class="o">=</span><span class="n">x_size</span><span class="p">,</span>
            <span class="n">y_size</span><span class="o">=</span><span class="n">y_size</span><span class="p">,</span>
            <span class="n">z_coord</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
            <span class="n">resindex</span><span class="o">=</span><span class="n">resindex</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">bead_plans</span> <span class="o">+=</span> <span class="n">plan</span>
    <span class="k">return</span> <span class="n">bead_plans</span></div>

    
    
<div class="viewcode-block" id="bead_plan">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.bead_plan">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bead_plan</span><span class="p">(</span>
        <span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">x_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">y_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">z_coord</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">resindex</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a PDB plan made of beads.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spacing : float, optional</span>
<span class="sd">        Spacing (in Angstrom) between beads in same dimension, by default 40</span>
<span class="sd">    x_size : float, optional</span>
<span class="sd">        Width (in Angstrom) of the plan, by default 200</span>
<span class="sd">    y_size : float, optional</span>
<span class="sd">        Height (in Angstrom) of the plan, by default 200</span>
<span class="sd">    z_coord : float, optional</span>
<span class="sd">        Z-coordinate where to generate the plan, by default 0</span>
<span class="sd">    resindex : int, optional</span>
<span class="sd">        From which resiude to start the , by default 0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plan : str</span>
<span class="sd">        The PDB plan made of beads.</span>
<span class="sd">    resindex : int</span>
<span class="sd">        Index of the last residue index added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plan_beads</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Loop over x coords</span>
    <span class="k">for</span> <span class="n">x_coord</span> <span class="ow">in</span> <span class="n">step_coords</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
        <span class="c1"># Loop over y coords</span>
        <span class="k">for</span> <span class="n">y_coord</span> <span class="ow">in</span> <span class="n">step_coords</span><span class="p">(</span><span class="n">y_size</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
            <span class="n">resindex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Generate new bead</span>
            <span class="n">bead</span> <span class="o">=</span> <span class="n">shape_bead</span><span class="p">(</span><span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">,</span> <span class="n">z_coord</span><span class="p">,</span> <span class="n">resindex</span><span class="p">)</span>
            <span class="n">plan_beads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bead</span><span class="p">)</span>
    <span class="c1"># Finalize plan</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plan_beads</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plan</span><span class="p">,</span> <span class="n">resindex</span></div>



<div class="viewcode-block" id="step_coords">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.step_coords">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">step_coords</span><span class="p">(</span><span class="n">_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">_spacing</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate set of evenly spaced coordinates between of defined size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : float</span>
<span class="sd">        Size (in Angstrom) to be sampled</span>
<span class="sd">    spacing : float</span>
<span class="sd">        Spacing between each coordinate</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    Generator[float, None, None]</span>
<span class="sd">        1D coodinate of current position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert to absolute value</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_size</span><span class="p">)</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_spacing</span><span class="p">)</span>
    <span class="c1"># Check if size is indeed greater than spacing</span>
    <span class="k">if</span> <span class="n">spacing</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Size must be greater than spacing!&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">return</span> <span class="n">_step_coords</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_step_coords</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate set of evenly spaced coordinates between of defined size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : float</span>
<span class="sd">        Size (in Angstrom) to be sampled</span>
<span class="sd">    spacing : float</span>
<span class="sd">        Spacing between each coordinate</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    float</span>
<span class="sd">        1D coodinate of current position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define initial position</span>
    <span class="n">coord</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Define oversized position</span>
    <span class="n">oversized</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># Loop until oversized</span>
    <span class="k">while</span> <span class="n">coord</span> <span class="o">&lt;=</span> <span class="n">oversized</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">coord</span>
        <span class="n">coord</span> <span class="o">+=</span> <span class="n">spacing</span>


<div class="viewcode-block" id="shape_bead">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.shape_bead">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">shape_bead</span><span class="p">(</span>
        <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">z</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">resindex</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">chain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span>
        <span class="n">atindex</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">bfactor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.00</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a PDB shape bead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float</span>
<span class="sd">        x coordinate of the bead</span>
<span class="sd">    y : float</span>
<span class="sd">        y coordinate of the bead</span>
<span class="sd">    z : float</span>
<span class="sd">        z coordinate of the bead</span>
<span class="sd">    resindex : int</span>
<span class="sd">        Residue index</span>
<span class="sd">    chain : str, optional</span>
<span class="sd">        Chain id, by default &quot;S&quot;</span>
<span class="sd">    atindex : int, optional</span>
<span class="sd">        Atome index, by default 1</span>
<span class="sd">    bfactor : float, optional</span>
<span class="sd">        B-factor of the bead, by default 1.00</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bead : str</span>
<span class="sd">        A valid PDB shape bead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bead</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ATOM  </span><span class="si">{</span><span class="n">atindex</span><span class="si">:</span><span class="s2">&gt;5d</span><span class="si">}</span><span class="s2">  SHA SHA </span><span class="si">{</span><span class="n">chain</span><span class="si">}{</span><span class="n">resindex</span><span class="si">:</span><span class="s2">&gt;4d</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">-8.3f</span><span class="si">}{</span><span class="n">y</span><span class="si">:</span><span class="s2">-8.3f</span><span class="si">}{</span><span class="n">z</span><span class="si">:</span><span class="s2">-8.3f</span><span class="si">}</span><span class="s2">  1.00</span><span class="si">{</span><span class="n">bfactor</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">         SHA  </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># noqa : E501</span>
    <span class="k">return</span> <span class="n">bead</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_get_ideal_restraint_dist</span><span class="p">(</span><span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes ideal restraint distance based on spacing.</span>

<span class="sd">    Basically, want to return (spacing / 2) - 2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spacing : int</span>
<span class="sd">        Spacing between beads.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Effective distance restraint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute de distance</span>
    <span class="n">effective_distance_restraint</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="c1"># Make sure it is not out of allowed boundaries</span>
    <span class="n">bounded_distance_restraint</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">effective_distance_restraint</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bounded_distance_restraint</span>


<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../../clients/haddock.clis.restraints.z_surface_restraints.html#haddock.clis.restraints.z_surface_restraints.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span>
        <span class="n">pdb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">residues</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">x_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">y_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">z_padding</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate both z-restraints and z-surface beads from residue selection.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pdb : Union[str, Path]</span>
<span class="sd">        Path to the PDB file to be parsed.</span>
<span class="sd">    residues : list[str]</span>
<span class="sd">        List of strings containing coma separated resids, by default None</span>
<span class="sd">    spacing : float, optional</span>
<span class="sd">        Spacing (in Angstrom) between beads in same dimension, by default 40</span>
<span class="sd">    x_size : float, optional</span>
<span class="sd">        Width (in Angstrom) of the plan, by default 200</span>
<span class="sd">    y_size : float, optional</span>
<span class="sd">        Height (in Angstrom) of the plan, by default 200</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[Union[str, Path], Union[str, Path]]</span>
<span class="sd">        Paths to the Z_restraints.tbl and Z_surface.pdb</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load residue selection</span>
    <span class="n">res_select</span> <span class="o">=</span> <span class="n">load_selections</span><span class="p">(</span><span class="n">residues</span><span class="p">)</span>
    <span class="c1"># Load corresponding coordinates</span>
    <span class="n">select_coords</span><span class="p">,</span> <span class="n">chainids</span><span class="p">,</span> <span class="n">atomtypes</span> <span class="o">=</span> <span class="n">load_selected_resiudes_coords</span><span class="p">(</span>
        <span class="n">pdb</span><span class="p">,</span> <span class="n">res_select</span>
        <span class="p">)</span>
    <span class="c1"># Compute z-coordinates for each selection</span>
    <span class="n">selection_z</span> <span class="o">=</span> <span class="n">get_z_coords</span><span class="p">(</span><span class="n">select_coords</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">z_padding</span><span class="p">)</span>
    <span class="c1"># Generate corresponding z-surfaces</span>
    <span class="n">plans</span> <span class="o">=</span> <span class="n">gen_bead_plans</span><span class="p">(</span>
        <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
        <span class="n">x_size</span><span class="o">=</span><span class="n">x_size</span><span class="p">,</span>
        <span class="n">y_size</span><span class="o">=</span><span class="n">y_size</span><span class="p">,</span>
        <span class="n">z_coords</span><span class="o">=</span><span class="p">[</span><span class="n">zcoord</span> <span class="k">for</span> <span class="n">zcoord</span> <span class="ow">in</span> <span class="n">selection_z</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
        <span class="p">)</span>
    <span class="c1"># Compute ideal restraint distance based on spacing</span>
    <span class="n">restraint_distance</span> <span class="o">=</span> <span class="n">_get_ideal_restraint_dist</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span>
    <span class="c1"># Generate corresponding z-surface restraints</span>
    <span class="n">restraints</span> <span class="o">=</span> <span class="n">gen_z_restraints</span><span class="p">(</span>
        <span class="n">res_select</span><span class="p">,</span>
        <span class="n">selection_z</span><span class="p">,</span>
        <span class="n">rest_dist</span><span class="o">=</span><span class="n">restraint_distance</span><span class="p">,</span>
        <span class="n">segids</span><span class="o">=</span><span class="n">chainids</span><span class="p">,</span>
        <span class="n">atome_types</span><span class="o">=</span><span class="n">atomtypes</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Output data</span>
    <span class="n">restraints_tbl</span><span class="p">,</span> <span class="n">plans_pdb</span> <span class="o">=</span> <span class="n">output_data</span><span class="p">(</span><span class="n">restraints</span><span class="p">,</span> <span class="n">plans</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">restraints_tbl</span><span class="p">,</span> <span class="n">plans_pdb</span></div>



<span class="n">gen_z_surface_restraints</span> <span class="o">=</span> <span class="n">main</span>


<span class="c1">############################</span>
<span class="c1"># COMMAND LINE ENTRY POINT #</span>
<span class="c1">############################</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
    <span class="c1"># Command line interface parser</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;haddock3-restraints&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">add_z_surf_restraints_arguments</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">ap</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
    <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;log_level&#39;</span><span class="p">])</span>
    <span class="c1"># Launch main</span>
    <span class="n">restraints_fpath</span><span class="p">,</span> <span class="n">plan_s_fpath</span> <span class="o">=</span> <span class="n">gen_z_surface_restraints</span><span class="p">(</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;residues&#39;</span><span class="p">],</span>
        <span class="n">residues</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;residues&#39;</span><span class="p">],</span>
        <span class="n">output</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">],</span>
        <span class="n">spacing</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;spacing&#39;</span><span class="p">],</span>
        <span class="n">x_size</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;x_size&#39;</span><span class="p">],</span>
        <span class="n">y_size</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;y_size&#39;</span><span class="p">],</span>
        <span class="n">z_padding</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;z_padding&#39;</span><span class="p">],</span>
        <span class="n">log_level</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;log_level&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">restraints_fpath</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">plan_s_fpath</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, BonvinLab.
      <span class="lastupdated">Last updated on Sep 27, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>